namespace = regentmaker
planet_event = {
	id = regentmaker.1
	title = "regentmaker.1"
	desc = "regentmaker.1.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	immediate = {
		ROOT.owner = {
			save_event_target_as = decentralizer
			if = {
				limit = {
					NOT = {
						has_country_flag = first_alien_life
					}
				}
				set_country_flag = first_alien_life
				set_timed_country_flag = { flag =  not_alien_life days = 10 }
			}
			if = {
				limit = {
					NOT = {
						has_country_flag = has_encountered_other_empire
					}
				}
				set_country_flag = has_encountered_other_empire
				set_timed_country_flag = { flag =  not_encountered_other_empire days = 10 }
			}
		}
	}
	option = {
		name = "regentmaker.1.a"
		hidden_effect = {
			# set_timed_planet_flag = { flag = regentmaker_vassal days = 10 }
			remove_planet_flag = regentmaker_tributary
			remove_planet_flag = regentmaker_member_state
			planet_event = { id = regentmaker.2 }
		}
	}
	option = {
		name = "regentmaker.1.b"
		hidden_effect = {
			set_timed_planet_flag = {
				flag = regentmaker_tributary
				days = 7
			}
			# remove_planet_flag = regentmaker_vassal
			remove_planet_flag = regentmaker_member_state
			planet_event = { id = regentmaker.2 }
		}
	}
	option = {
		name = "regentmaker.1.c"
		trigger = {
			event_target:decentralizer = { has_modifier = decentralized_leader }
		}
		hidden_effect = {
			set_timed_planet_flag = {
				flag = regentmaker_member_state
				days = 7
			}
			# remove_planet_flag = regentmaker_vassal
			remove_planet_flag = regentmaker_tributary
			planet_event = { id = regentmaker.2 }
		}
	}
	option = {
		name = distar.1055.b		# "Leave it be."
		hidden_effect = {
			owner = {
				every_owned_planet = {
					limit = { has_planet_flag = regentmaker_handover }
					remove_planet_flag = regentmaker_handover
				}
			}
		}
	}
}

planet_event = {
	id = regentmaker.2
	title = "regentmaker.1"
	desc = "regentmaker.2.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	option = {
		name = "regentmaker.2.a"
		hidden_effect = {
			owner_species = { save_event_target_as = vassal_species }
			# owner = { random_owned_planet = { limit = { has_planet_flag = regentmaker_handover }
			planet_event = { id = regentmaker.3 }
			# 	} }
		}
	}
	option = {
		name = "regentmaker.2.b"
		hidden_effect = {
			if = {
				limit = { exists = event_target:vassal_species }
				no_scope = { save_event_target_as = vassal_species }
			}
			# owner = { random_owned_planet = { limit = { has_planet_flag = regentmaker_handover }
			planet_event = { id = regentmaker.3 }
			# } }
		}
	}
	option = {
		# "Leave it be."
		name = distar.1055.b
		hidden_effect = {
			owner = {
				every_owned_planet = {
					limit = { has_planet_flag = regentmaker_handover }
					remove_planet_flag = regentmaker_handover
				}
			}
		}
	}
}

planet_event = {
	id = regentmaker.3
	location = ROOT
	hide_window = yes
	is_triggered_only = yes
	# pre_triggers = {
	# 	has_owner = yes
	# 	is_ai = no
	# }
	# trigger = { # 	owner = { any_owned_planet = { has_planet_flag = regentmaker_handover } }
	# }
	immediate = {
		## Save target species
		get_vassal_species = yes

		create_country = {
			# name = random
			name = "[Prev.GetStarName]"
			name_list = event_target:decentralizer
			type = default
			ship_prefix = ""
			government_restrictions = { authority = { NOT = { value = auth_machine_intelligence value = auth_hive_mind } } }
			authority = event_target:decentralizer
			civics = random
			ignore_initial_colony_error = yes
			randomize_ethos = yes
			ethos = random
			species = event_target:vassal_species
			flag = random			# separate color definition not possible!?
			origin = origin_default
			# auto_delete = yes
			day_zero_contact = no
			exclude_day_zero_contact = event_target:decentralizer
			effect = {
				set_country_flag = first_alien_life
				set_country_flag = has_encountered_other_empire
				# change_country_flag = {  }
				# set_timed_relation_flag = { who = event_target:decentralizer flag = AbandonedRefugees days = 5 }
				# event_target:decentralizer = { set_timed_relation_flag = { who = prev flag = AbandonedRefugees days = 5 } }
				establish_communications_no_message = event_target:decentralizer
				add_resource = {
					minerals = 500
					energy = 1000
					unity = 10000
					influence = 500
				}
				if = {
					limit = {
						ROOT = { has_planet_flag = regentmaker_tributary }
					}
					set_subject_of = {
						who = event_target:decentralizer
						subject_type = tributary
					}
				}
				else_if = {
					limit = {
						ROOT = { has_planet_flag = regentmaker_member_state }
					}
					set_subject_of = {
						who = event_target:decentralizer
						subject_type = member_state
					}
				}
				else = {
					set_subject_of = {
						who = event_target:decentralizer
						subject_type = vassal
					}
				}
				set_faction_hostility = {
					set_hostile = no
					set_neutral = no
					set_friendly = yes
					target = event_target:decentralizer
				}
				# action_open_borders
				set_closed_borders = {
					who = event_target:decentralizer
					status = no
					forced = 5
				}
				# TODO test
				# change_dominant_species = { species = event_target:vassal_species change_all = yes }

				event_target:decentralizer = {
					set_country_flag = has_communications@prev
					set_faction_hostility = {
						set_hostile = no
						set_neutral = no
						set_friendly = yes
						target = prev
					}
					every_federation_ally = {
						establish_communications = prevprev
					}
					every_relation = {
						establish_communications_no_message = last_created_country
						# establish_contact = { who = last_created_country location = ROOT }
					}
					# action_open_borders
					set_closed_borders = {
						who = prev
						status = no
						forced = 5
					}
				}
				establish_communications_no_message = event_target:decentralizer
				# establish_contact = { who = event_target:decentralizer location = event_target:decentralizer.capital_scope }
				copy_techs_from = {
					target = event_target:decentralizer
					except = {
						# Horizon Signal
						tech_akx_worm_1
						tech_akx_worm_2
						tech_akx_worm_3
					}
				}
				if = {
					limit = {
						NOT = { is_same_species = event_target:decentralizer }
					}
					# if = { limit = { is_homeworld = yes } }
					set_name = "[This.owner_species.GetName]"
				} else = {
					copy_ethos_and_authority = event_target:decentralizer
					change_government = {
						authority = auth_imperial
						civics = random
					}
				}
				if = {
					limit = {
						FROM = { has_planet_flag = regentmaker_handover }
					}
					log = "Release selected planet [From.GetName]!"
					FROM = {
						planet_event = { id = regentmaker.9 }
					}
				}
				add_opinion_modifier = {
					who = event_target:decentralizer
					modifier = opinion_scion
				}
				add_opinion_modifier = {
					who = event_target:decentralizer
					modifier = opinion_ceded_starbase					# opinion_trust
				}
				add_opinion_modifier = {
					who = event_target:decentralizer
					modifier = opinion_enlightened_us					# opinion_common_ground
				}
				if = {
					limit = {
						exists = event_target:vassal_leader
						event_target:vassal_leader = {
							NOT = { leader_class = ruler }
						}
					}
					# sector = {
					log="New leader [vassal_leader.GetName]"
					event_target:vassal_leader = { set_owner = prev }
					assign_leader = event_target:vassal_leader
					no_scope = { save_event_target_as = vassal_leader }	# remove only for sure
				}
				create_starting_leaders = yes
				create_starting_fleets = yes
			}
		}

		# last_created_country = {}
		event_target:decentralizer = {
			every_owned_planet = {
				limit = {
					has_planet_flag = regentmaker_handover
					# has_owner = yes
					# is_homeworld = no
					# original_owner = yes
					has_ground_combat = no
					is_capital = no
					is_occupied_flag = no
				}
				# log = "Release planet [This.GetName]!"
				planet_event = { id = regentmaker.9 }
			}
			establish_communications_no_message = last_created_country
			# establish_contact = { who = last_created_country location = ROOT }
			if = {
				limit = {
					has_country_flag = not_encountered_other_empire
				}
				remove_country_flag = has_encountered_other_empire
			}
			if = {
				limit = {
					has_country_flag = not_alien_life
				}
				remove_country_flag = first_alien_life
			}
		}
	}
}

country_event = {
	id = regentmaker.4
	title = "regentmaker.4"
	desc = "regentmaker.4.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	option = {
		name = "regentmaker.4.a"
		every_subject = {
			copy_techs_from = { target = root }
		}
	}
	option = {
		name = "regentmaker.4.b"
		every_subject = {
			root = {
				copy_techs_from = { target = prev }
			}
		}
	}
	# "Leave it be." tech_unlocked_ratio
	option = { name = distar.1055.b }
}

country_event = {
	id = regentmaker.7
	title = "regentmaker.7"
	desc = "regentmaker.7.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	# immediate = {
	# 	random_subject = {
	# 		save_event_target_as = vassal_empire
	# 	}
	# }
	option = {
		name = "regentmaker.7.a"
		every_subject = { clear_ethos = yes }
	}
	option = {
		name = "ethic_fanatic_authoritarian"
		every_subject = { country_add_ethic = ethic_fanatic_authoritarian }
	}
	option = {
		name = "ethic_authoritarian"
		every_subject = { country_add_ethic = ethic_authoritarian }
	}
	option = {
		name = "ethic_fanatic_egalitarian"
		every_subject = { country_add_ethic = ethic_fanatic_egalitarian }
	}
	option = {
		name = "ethic_egalitarian"
		every_subject = { country_add_ethic = ethic_egalitarian }
	}
	option = {
		name = "ethic_fanatic_xenophobe"
		every_subject = { country_add_ethic = ethic_fanatic_xenophobe }
	}
	option = {
		name = "ethic_xenophobe"
		every_subject = { country_add_ethic = ethic_xenophobe }
	}
	option = {
		name = "ethic_fanatic_xenophile"
		every_subject = { country_add_ethic = ethic_fanatic_xenophile }
	}
	option = {
		name = "ethic_xenophile"
		every_subject = { country_add_ethic = ethic_xenophile }
	}
	option = {
		name = "ethic_fanatic_militarist"
		every_subject = { country_add_ethic = ethic_fanatic_militarist }
	}
	option = {
		name = "ethic_militarist"
		every_subject = { country_add_ethic = ethic_militarist }
	}
	option = {
		name = "ethic_fanatic_pacifist"
		every_subject = { country_add_ethic = ethic_fanatic_pacifist }
	}
	option = {
		name = "ethic_pacifist"
		every_subject = { country_add_ethic = ethic_pacifist }
	}
	option = {
		name = "ethic_fanatic_spiritualist"
		every_subject = { country_add_ethic = ethic_fanatic_spiritualist }
	}
	option = {
		name = "ethic_spiritualist"
		every_subject = { country_add_ethic = ethic_spiritualist }
	}
	option = {
		name = "ethic_fanatic_materialist"
		every_subject = { country_add_ethic = ethic_fanatic_materialist }
	}
	option = {
		name = "ethic_materialist"
		every_subject = { country_add_ethic = ethic_materialist }
	}
	# option = { # not wanted side effects
	# 	name = "ethic_gestalt_consciousness"
	# 	every_subject = { country_add_ethic = ethic_gestalt_consciousness }
	# }
	option = {
		name = leviathans.105.d		# Nothing for now. Goodbye.
		# hidden_effect = {
		# 	no_scope = {
		# 		save_event_target_as = vassal_empire
		# 	}
		# }
	}
	# after = {
	# 	hidden_effect = {
	# 		if = {
	# 			limit = {
	# 				exists = event_target:vassal_empire
	# 				is_scope_type = country
	# 			}
	# 			every_subject = {
	# 				limit = {
	# 					NOR = {
	# 						is_same_empire = event_target:vassal_empire
	# 						has_same_ethos = event_target:vassal_empire
	# 					}
	# 				}
	# 				copy_ethos_and_authority = event_target:vassal_empire
	# 				# shift_ethic = event_target:vassal_empire
	# 			}
	# 		}
	# 	}
	# }
}

country_event = {
	id = regentmaker.8
	title = "regentmaker.8"
	desc = "regentmaker.8.desc"
	picture = GFX_evt_throne_room
	is_triggered_only = yes
	# immediate = {
	# 	random_subject = {
	# 		limit = { is_regular_empire = yes }
	# 		save_event_target_as = vassal_empire
	# 	}
	# }
	option = {
		name = "auth_democratic"
		every_subject = {
			limit = { is_regular_empire = yes }
			change_government = { authority = auth_democratic }
		}
	}
	option = {
		name = "auth_oligarchic"
		every_subject = {
			limit = { is_regular_empire = yes }
			change_government = { authority = auth_oligarchic }
		}
	}
	option = {
		name = "auth_dictatorial"
		every_subject = {
			limit = { is_regular_empire = yes }
			change_government = { authority = auth_dictatorial }
		}
	}
	option = {
		name = "auth_imperial"
		every_subject = {
			limit = { is_regular_empire = yes }
			change_government = { authority = auth_imperial }
		}
	}
	option = {
		name = "auth_corporate"
		every_subject = {
			limit = { is_regular_empire = yes }
			change_government = { authority = auth_corporate }
		}
	}
	# option = { # not wanted
	# 	name = "auth_hive_mind"
	# 	every_subject = {
	# 		change_government = { authority = auth_hive_mind }
	# 	}
	# }
	# option = { # not wanted
	# 	name = "auth_machine_intelligence"
	# 	every_subject = {
	# 		change_government = { authority = auth_machine_intelligence }
	# 	}
	# }
	option = {
		name = leviathans.105.d		# Nothing for now. Goodbye.
		# hidden_effect = {
		# 	no_scope = {
		# 		save_event_target_as = vassal_empire
		# 	}
		# }
	}
	# after = {
	# 	hidden_effect = {
	# 		if = {
	# 			limit = {
	# 				exists = event_target:vassal_empire
	# 				is_scope_type = country
	# 			}
	# 			every_subject = {
	# 				limit = {
	# 					NOT = {
	# 						is_same_empire = event_target:vassal_empire
	# 					}
	# 				}
	# 				copy_ethos_and_authority = event_target:vassal_empire
	# 				# change_government = {
	# 				# 	authority = event_target:vassal_empire
	# 				# 	# civics = random
	# 				# }
	# 			}
	# 		}
	# 	}
	# }
}

planet_event = {
	id = regentmaker.9
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		set_controller = last_created_country
		set_owner = last_created_country
		remove_planet_flag = regentmaker_handover
		solar_system = {
			if = {
				limit = { exists = starbase }
				starbase = { set_owner = last_created_country }
			}
			every_neighbor_system = {
				limit = {
					exists = starbase
					is_owned_by = event_target:decentralizer
				}
				if = {
					limit = {
						any_system_planet = {
							# has_owner = yes
							# owner = { is_same_empire = event_target:decentralizer }
							is_owned_by = event_target:decentralizer
							has_planet_flag = regentmaker_handover
						}
					}
					starbase = { set_owner = last_created_country }
					every_system_planet = {
						limit = {
							# has_owner = yes
							# owner = { is_same_empire = event_target:decentralizer }
							is_owned_by = event_target:decentralizer
							NOT = { is_same_value = prevprev }
						}
						if = {
							limit = { has_planet_flag = regentmaker_handover }
							remove_planet_flag = regentmaker_handover
							set_controller = last_created_country
							set_owner = last_created_country
						}
						else = {
							starbase = { set_owner = event_target:decentralizer }
						}
					}
				}
				else_if = {
					limit = {
						NOT = {
							any_system_planet = {
								is_star = no
								is_asteroid = no
								has_owner = yes
							}
						}
					}
					starbase = { set_owner = last_created_country }
				}
				# else = { }
			}
			every_system_planet = {
				limit = {
					is_star = no
					is_asteroid = no
					# has_owner = yes
					is_owned_by = event_target:decentralizer
					# owner = {
					# 	is_same_empire = event_target:decentralizer
					# }
					NOT = { is_same_value = prevprev }
				}
				if = {
					limit = { has_planet_flag = regentmaker_handover }
					remove_planet_flag = regentmaker_handover
				}
				set_controller = last_created_country
				set_owner = last_created_country
			}
		}
		last_created_country = {
			add_resource = {
				minerals = 250
				energy = 500
			}
			capital_scope = {
				add_modifier = {
					modifier = "regentmaker_colony"
					days = -1
				}
			}
		}
	}
}
